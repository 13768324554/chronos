define(["underscore"],function(e){function t(e){if(!(this instanceof t))return new t(e);this._stack=[],this.pushAll(e)}function n(){if(!(this instanceof n))return new n;this.balances={},this.stacks={}}function r(e,t,n,r){e[t]||(e[t]={}),e[t][t+n]=n===r}function i(e,t,n){var r=e[t],i=r&&r[t+n];return delete r[t+n],r&&i}return e.extend(t.prototype,{push:function(e){if(!!e||e===0)return this._stack.push(e)},pop:function(){return this._stack.pop()}}),e.extend(n.prototype,{startBalance:function(e,t,n){return r(this.balances,e,t,n),!1},hasBalance:function(e,t){return!!(this.balances&&this.balances[e]&&this.balances[e][e+t])},getBalance:function(e,t,n){var r=t===n;if(i(this.balances,e,t)===r)return!0},forceBalance:function(e,t){return i(this.balances,e,t),!0}}),n});