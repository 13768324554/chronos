define(["underscore","backbone"],function(e,t){function n(e){return!isNaN(e-0)&&e!=null&&!e.length&&e!==""}function r(e,t){if(!(this instanceof r))return new r(e,t);this.start=e,this.end=t}function i(){if(!(this instanceof i))return new i;this.currentRange=null,this.lastValue=null,this.ranges=[],this.index=-1}return e.extend(r.prototype,{clone:function(){return new r(this.start,this.end)},has:function(e){return n(this[e])},isValid:function(){return this.has("start")&&this.has("end")},set:function(e,t){return n(t)&&(this[e]=t),this}}),e.extend(i.prototype,{clone:function(){var t=new i;return e.extend(t,{currentRange:this.currentRange&&this.currentRange.clone(),lastValue:this.lastValue,ranges:e.clone(this.ranges),index:this.index}),this.currentRange&&(this.currentRange.has("start")||this.currentRange.has("end")),t},increment:function(e){var t=this.lastValue!==e;return this.index+=1,t&&this.currentRange&&this.currentRange.isValid()&&(this.ranges.push(this.currentRange),this.currentRange=new r),this.lastValue=e,t},run:function(){this.increment("run"),this.currentRange?this.currentRange.has("start")||this.currentRange.set("start",this.index):this.currentRange=new r(this.index)},skip:function(){var e=this.increment("skip");this.currentRange&&this.currentRange.has("start")&&!this.currentRange.has("end")&&this.currentRange.set("end",this.index)},getRuns:function(){var t=this.index,n=this.lastValue,r;return this.skip(),this.increment("getRuns"),r=e.map(this.ranges,function(e){return{start:e.start,end:e.end}}),this.index=t,this.lastValue=n,r},lastWas:function(e){return this.lastValue===e}}),i});