define(["underscore"],function(e){function r(e,n){return!e[t]||!e[t][n]?null:e[t][n]}function i(n,r,i){n[t]||(n[t]={}),e.isObject(r)?e.merge(n[t],r):n[t][r]=i}function s(e,n){if(!e||!e[t])return;!!n&&e[t][n]?delete e[t][n]:delete e[t]}function o(t,n,i){var s=r(this,"views"),o=i&&i.viewOptions,u=s[t.cid],a=r(this,"viewClassName"),f;return u||(f=e.isString(a)?require(a):a,u=new f({model:t,options:o||{}}),s[t.cid]=u),u}function u(t){var n=r(this,"views"),i=n[t.cid];if(!i)return;return delete [n[t.cid]],e.isFunction(i.close)?i.close():(i.undelegateEvents(),i.remove())}function a(){var t=r(this,"views"),n=this;e.each(t,function(e,t){u.call(n,{cid:t})})}var t="_childViews",n;return n={initParentView:function(e){return!!r(this,"views")||!e?!1:(i(this,{views:{},viewClassName:e}),!0)},bindCollectionViews:function(t,n){if(!this.initParentView(t))return;return this.renderChildViews=e.bind(this._renderChildViews,this,n),this.listenTo(n,{add:this._childAdded,remove:this._childRemoved,reset:this._childrenReset,sort:this._childrenSorted}).listenTo(this,{render:this.renderChildViews}),this},$childViewContainer:function(){return this.$el},addChildView:function(e){this.$childViewContainer().prepend(e.render().$el)},_childAdded:function(e,t,n){var i=o.call(this,e,t,n),s="parentView:renderChild parentView:renderChild:";this.addChildView(i),this.trigger(s+e.cid,{childView:r(this,"views")[e.cid]}),i.trigger("childView:render",{parentView:this})},_childRemoved:function(e,t,n){u.call(this,e,t,n)},_childrenReset:function(e,t){this.$childViewContainer().html(""),a.call(this),this.renderChildViews()},_childrenSorted:function(e,t){var n=this,i=this.$childViewContainer(),s=r(this,"views"),o;e.each(function(e){o=s[e.cid];if(!o)return;o.$el.detach().appendTo(i)})},_renderChildViews:function(e){var t=this,n;this.trigger("parentView:beforeRenderChildren"),e.each(function(n){t._childAdded(n,e,{})}),this.trigger("parentView:afterRenderChildren")},unbindCollectionViews:function(){return a.call(this),s(this),this}},{InstanceMethods:n}});