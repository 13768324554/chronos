define(["backbone","underscore"],function(e,t){var n,r,i;return i=function(){},t.extend(i,{merge:function(e){return t.extend.apply(null,[{}].concat(e))}}),r=function s(e,t){if(!(this instanceof s))return new s(e);this.name=e,this.failures=[],this.subfailures={}},t.extend(r.prototype,{should:function(t,n){!this.failures.length&&!n.call()&&this.failures.push(t)},context:function(n,i,s){var o,u;this.subfailures[n]=o=new r(n),u=s?t.isArray(s)?s:[s]:[],i.apply(o,u.concat([]))},getModel:function(){return this.model&&this.model instanceof e.Model?this.model:null},withCollection:function(t){debugger;var n=this.getCollection();return!!n&&!!t&&!!t.call(null,n)},getCollection:function(){var t=this.getModel();return t?t.collection:null},getFailures:function(){var n;return n=t.extend.apply(null,[{}].concat(t.map(this.subfailures,function(e,n){var r={};return r[n]=t.map(e.getFailures()[n],function(e){return[n,e].join(" ")}),r}))),n[this.name]=t.map(this.failures,function(e){return[this.name,"should",e].join(" ")},this),n}}),n=function o(e,t){if(!(this instanceof o))return new o(e,t);this._setOptions(e,t)},t.extend(n.prototype,{initialize:function(){},_setOptions:function(r,i){this.validations=t.reduce(i,function(e,r,i){var s;return t.isString(r)?s=n._namedValidations[r]:t.isFunction(r)&&(s=r),!s||(e[i]=s),e},{},this),this.model=r,this.errors={},this.isPlain=!(this.model instanceof e.Model)},get:function(e){return this.model?(console.log("this",this,"this.model",this.model),this.isPlain?this.model[e]:this.model.get(e)):null},validate:function(){var e;return e=t.reduce(this.validations,function(e,n,i){var s,o,u,a;return a=new r("base",this.model),s=this.get(i),a.context(i,n,s),o=a.getFailures(),u=t.isEmpty(o),u||(e[i]=o[i]),e},{},this),console.log("errors",e),this.errors=e},isValid:function(){return this.validate(),t.size(this.errors)===0},getErrors:function(){return this.validate(),t.extend({},this.errors,{size:t.size(this.errors)})}}),t.extend(n,{extend:e.Model.extend,addNamedValidation:function(e,r){t.isFunction(r)&&(n._namedValidations[e]=r)},removeNamedValidation:function(e){return n._namedValidations[e]=null,n},_namedValidations:{},from:function(){var e,r,s;return e=Array.prototype.slice.call(arguments),r=t.filter(e,function(e){return e instanceof i||t.isObject(e)}),s=i.merge.call(null,r),{create:function(e){return new n(e,s)}}}}),n});